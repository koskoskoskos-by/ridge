{%extends 'base.html'%}
{%block content%}
   {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <ul class="flash-messages">
            {% for category, message in messages %}
                <li class="flash {{ category }}">{{ message }}</li>
            {% endfor %}
    </ul>
  {% endif %}
{% endwith %}
<main>
    <h1 id="shop">Магазин</h1>
     <div id="sort">
    <label for="sort-options">Сортировать по:</label>
    <select id="sort-options" onchange="updateSort()">
        <option value="stock_quantity desc" {% if sort_by == 'stock_quantity desc' %}selected{% endif %}>Популярные</option>
        <option value="price" {% if sort_by == 'price' %}selected{% endif %}>По возрастанию цены</option>
        <option value="price desc" {% if sort_by == 'price desc' %}selected{% endif %}>По убыванию цены</option>
    </select>
    </div>
    <ul class="tovar">
        {% for p in products %}
        {%if p.stock_quantity>0%}
            <li>
                <img src="{{ p.image_url }}" alt="{{ p.name }}">
                <p>{{ p.name }} — {{ p.price }} р.</p>
                <form action="/add-to-cart" method="POST">
                <input type="hidden" name="id" value="{{ p.id }}">
                <button type="submit" class="buy-btn">Купить</button>
                </form>
            </li>
        {%endif%}
        {% endfor %}
    </ul>
</main>
<script>
function updateSort() {
    const value = document.getElementById("sort-options").value;
    window.location.href = `/?sort=${value}`;
}
</script>
{%endblock%}
